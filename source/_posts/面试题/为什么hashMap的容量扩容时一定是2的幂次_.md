---
title: ä¸ºä»€ä¹ˆhashMapçš„å®¹é‡æ‰©å®¹æ—¶ä¸€å®šæ˜¯2çš„å¹‚æ¬¡
date: 2024-10-16 13:33:41
tags:
	- é›†åˆ
categories: é¢è¯•
---
# ğŸ‘Œä¸ºä»€ä¹ˆhashMapçš„å®¹é‡æ‰©å®¹æ—¶ä¸€å®šæ˜¯2çš„å¹‚æ¬¡?

# é¢˜ç›®è¯¦ç»†ç­”æ¡ˆ
åœ¨HashMapä¸­ï¼Œåˆå§‹åŒ–è®¾ç½®é•¿åº¦æ—¶ï¼Œå®¹é‡è‡ªåŠ¨è½¬æˆ 2 çš„å¹‚æ¬¡é•¿åº¦ï¼Œè¿™æ ·è®¾è®¡æœ‰å‡ ä¸ªé‡è¦åŸå› ï¼Œä¸»è¦æ˜¯ä¸ºäº†ä¼˜åŒ–æ€§èƒ½å’Œç®€åŒ–è®¡ç®—ã€‚

## é«˜æ•ˆè®¡ç®—ç´¢å¼•
HashMapä½¿ç”¨å“ˆå¸Œå€¼æ¥ç¡®å®šé”®å€¼å¯¹åœ¨å“ˆå¸Œè¡¨ä¸­çš„ä½ç½®ã€‚ä¸ºäº†è®¡ç®—æ•°ç»„ç´¢å¼•ï¼ŒHashMapä½¿ç”¨æŒ‰ä½ä¸æ“ä½œä»£æ›¿å–æ¨¡è¿ç®—ã€‚å…·ä½“æ¥è¯´ï¼ŒHashMapé€šè¿‡ä»¥ä¸‹æ–¹å¼è®¡ç®—ç´¢å¼•ï¼š

```plain
int index= (n - 1) & hash;
```

å…¶ä¸­næ˜¯å“ˆå¸Œè¡¨æ•°ç»„çš„é•¿åº¦ã€‚å‡è®¾næ˜¯ 2 çš„å¹‚æ¬¡ï¼Œæ¯”å¦‚ 16ï¼ˆ2^4ï¼‰ï¼Œåˆ™n - 1æ˜¯ 15ï¼ˆ1111 äºŒè¿›åˆ¶ï¼‰ã€‚è¿™æ ·ï¼Œ(n - 1) & hashæ“ä½œå¯ä»¥å¿«é€Ÿåœ°å¯¹å“ˆå¸Œå€¼è¿›è¡Œå–æ¨¡è¿ç®—ï¼Œè€Œä¸éœ€è¦ä½¿ç”¨æ€§èƒ½è¾ƒä½çš„å–æ¨¡æ“ä½œ%ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœnæ˜¯ 16ï¼ˆ2^4ï¼‰ï¼š

+ n - 1æ˜¯ 15ï¼ˆ1111 äºŒè¿›åˆ¶ï¼‰
+ æŒ‰ä½ä¸æ“ä½œ(n - 1) & hashåªä¿ç•™å“ˆå¸Œå€¼çš„ä½ 4 ä½ï¼Œè¿™ç›¸å½“äºå¯¹ 16 å–æ¨¡ã€‚

è¿™ç§æ–¹å¼ä¸ä»…è®¡ç®—å¿«é€Ÿï¼Œè€Œä¸”ä»£ç ç®€æ´ã€‚

## å‡å°‘å“ˆå¸Œå†²çª
åœ¨å“ˆå¸Œè¡¨ä¸­ï¼Œå“ˆå¸Œå†²çªæ˜¯ä¸€ä¸ªä¸»è¦é—®é¢˜ã€‚å“ˆå¸Œå†²çªå‘ç”Ÿæ—¶ï¼Œä¸åŒçš„é”®è®¡ç®—å‡ºçš„ç´¢å¼•ç›¸åŒï¼Œå¯¼è‡´å®ƒä»¬è¢«å­˜å‚¨åœ¨åŒä¸€ä¸ªæ¡¶ä¸­ã€‚é€šè¿‡å°†å®¹é‡è®¾ç½®ä¸º 2 çš„å¹‚æ¬¡ï¼Œå“ˆå¸Œè¡¨èƒ½å¤Ÿæ›´å‡åŒ€åœ°åˆ†å¸ƒå“ˆå¸Œå€¼ï¼Œå‡å°‘å†²çªã€‚

å…·ä½“æ¥è¯´ï¼Œå½“å®¹é‡æ˜¯ 2 çš„å¹‚æ¬¡æ—¶ï¼Œå“ˆå¸Œå€¼çš„ä½ä½å’Œé«˜ä½éƒ½èƒ½å‡åŒ€åœ°å½±å“æœ€ç»ˆç´¢å¼•ã€‚è¿™æ˜¯å› ä¸ºæ‰°åŠ¨å‡½æ•°hash = h ^ (h >>> 16)å°†é«˜ä½å’Œä½ä½æ··åˆåœ¨ä¸€èµ·ï¼Œä½¿å¾—å“ˆå¸Œå€¼çš„åˆ†å¸ƒæ›´å‡åŒ€ã€‚

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªHashMapï¼Œå…¶å®¹é‡ä¸º 10ï¼ˆä¸æ˜¯ 2 çš„å¹‚æ¬¡ï¼‰ï¼Œå¹¶ä¸”æˆ‘ä»¬æœ‰ä¸€ç»„é”®ï¼Œå®ƒä»¬çš„å“ˆå¸Œå€¼åˆ†åˆ«ä¸ºï¼š

+ é”® A çš„å“ˆå¸Œå€¼ï¼š35
+ é”® B çš„å“ˆå¸Œå€¼ï¼š45
+ é”® C çš„å“ˆå¸Œå€¼ï¼š55

ï¼ˆ1ï¼‰ä½¿ç”¨é 2 çš„å¹‚æ¬¡å®¹é‡

å¦‚æœå®¹é‡ä¸º 10ï¼Œæˆ‘ä»¬è®¡ç®—ç´¢å¼•çš„æ–¹æ³•æ˜¯å–æ¨¡è¿ç®—ï¼š

+ é”® A çš„ç´¢å¼•ï¼š35 % 10 = 5
+ é”® B çš„ç´¢å¼•ï¼š45 % 10 = 5
+ é”® C çš„ç´¢å¼•ï¼š55 % 10 = 5

å¯ä»¥çœ‹åˆ°ï¼Œè¿™äº›ä¸åŒçš„é”®åœ¨å–æ¨¡è¿ç®—åéƒ½æ˜ å°„åˆ°åŒä¸€ä¸ªç´¢å¼• 5ï¼Œå¯¼è‡´äº†å“ˆå¸Œå†²çªã€‚

ï¼ˆ2ï¼‰ä½¿ç”¨ 2 çš„å¹‚æ¬¡å®¹é‡

ç°åœ¨å‡è®¾æˆ‘ä»¬å°†å®¹é‡è®¾ç½®ä¸º 16ï¼ˆ2^4ï¼‰ï¼Œå¹¶ä½¿ç”¨æŒ‰ä½ä¸æ“ä½œæ¥è®¡ç®—ç´¢å¼•ï¼š

+ é”® A çš„ç´¢å¼•ï¼š35 & (16 - 1) = 35 & 15 = 3
+ é”® B çš„ç´¢å¼•ï¼š45 & (16 - 1) = 45 & 15 = 13
+ é”® C çš„ç´¢å¼•ï¼š55 & (16 - 1) = 55 & 15 = 7

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™äº›é”®æ˜ å°„åˆ°ä¸åŒçš„ç´¢å¼•ï¼ˆ3ã€13 å’Œ 7ï¼‰ï¼Œæ²¡æœ‰å‘ç”Ÿå“ˆå¸Œå†²çªã€‚

## ç®€åŒ–æ‰©å®¹
HashMapåœ¨éœ€è¦æ‰©å®¹æ—¶ï¼Œé€šå¸¸ä¼šå°†å®¹é‡åŠ å€ã€‚å¦‚æœå®¹é‡æ€»æ˜¯ 2 çš„å¹‚æ¬¡ï¼Œé‚£ä¹ˆåŠ å€åçš„å®¹é‡ä»ç„¶æ˜¯ 2 çš„å¹‚æ¬¡ï¼Œè¿™æ ·å¯ä»¥ç®€åŒ–æ‰©å®¹è¿‡ç¨‹ä¸­çš„è®¡ç®—å’Œé‡æ–°å“ˆå¸Œæ“ä½œã€‚

## å†…å­˜å¯¹é½å’Œæ•ˆç‡
è®¡ç®—æœºå†…å­˜åˆ†é…é€šå¸¸æ›´é«˜æ•ˆåœ°å¤„ç† 2 çš„å¹‚æ¬¡å¤§å°çš„å†…å­˜å—ã€‚ä½¿ç”¨ 2 çš„å¹‚æ¬¡é•¿åº¦å¯ä»¥æ›´å¥½åœ°åˆ©ç”¨å†…å­˜å¯¹é½ï¼Œæé«˜å†…å­˜è®¿é—®æ•ˆç‡ã€‚

## å®ç°ç»†èŠ‚
å½“ä½ åˆå§‹åŒ–HashMapæ—¶ï¼ŒæŒ‡å®šçš„åˆå§‹å®¹é‡ä¼šè¢«è°ƒæ•´ä¸ºå¤§äºæˆ–ç­‰äºè¯¥å€¼çš„æœ€å°çš„ 2 çš„å¹‚æ¬¡ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æŒ‡å®šçš„åˆå§‹å®¹é‡æ˜¯ 10ï¼ŒHashMapä¼šå°†å…¶è°ƒæ•´ä¸º 16ï¼ˆ2^4ï¼‰ã€‚

å…·ä½“å®ç°å¦‚ä¸‹ï¼š

```plain
static final int tableSizeFor(int cap) {
    int n = cap - 1;
    n |= n >>> 1;
    n |= n >>> 2;
    n |= n >>> 4;
    n |= n >>> 8;
    n |= n >>> 16;
    return (n < 0) ? 1 : (n >= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1;
}
```

è¿™ä¸ªæ–¹æ³•é€šè¿‡ä¸€ç³»åˆ—çš„ä½ç§»å’ŒæŒ‰ä½æˆ–æ“ä½œï¼Œå°†ä»»æ„æ•´æ•°è°ƒæ•´ä¸ºå¤§äºæˆ–ç­‰äºå®ƒçš„æœ€å° 2 çš„å¹‚æ¬¡ã€‚ä½†æ˜¯è¿˜æœ‰ä¸€ç§ç‰¹æ®Šæƒ…å†µå¥—ç”¨ä»¥ä¸Šå…¬å¼ä¸è¡Œï¼Œè¿™äº›æ•°å­—å°±æ˜¯2çš„å¹‚è‡ªèº«ã€‚å¦‚æœæ•°å­—4 å¥—ç”¨å…¬å¼çš„è¯ã€‚å¾—åˆ°çš„ä¼šæ˜¯ 8 ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒJDKçš„å·¥ç¨‹å¸ˆæŠŠæ‰€æœ‰ç”¨æˆ·ä¼ è¿›æ¥çš„æ•°åœ¨è¿›è¡Œè®¡ç®—ä¹‹å‰å…ˆ-1ã€‚



> /yfxseowdd8g5hm0e>
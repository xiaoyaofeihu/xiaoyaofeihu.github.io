---
title: ğŸ‘Œä»€ä¹ˆæ˜¯javaå†…å­˜æ¨¡å‹
date: 2025-04-27 13:33:41
tags:
	- JVM
categories: ç¬”è®°
--- 
# ğŸ‘Œä»€ä¹ˆæ˜¯javaå†…å­˜æ¨¡å‹?

# é¢˜ç›®è¯¦ç»†ç­”æ¡ˆ
Java å†…å­˜æ¨¡å‹ï¼ˆJava Memory Model, JMMï¼‰æ˜¯ Java è™šæ‹Ÿæœºè§„èŒƒçš„ä¸€éƒ¨åˆ†ï¼Œå®šä¹‰äº†å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å…±äº«å˜é‡çš„è®¿é—®è§„åˆ™ä»¥åŠä¸åŒçº¿ç¨‹ä¹‹é—´å¦‚ä½•é€šè¿‡å†…å­˜è¿›è¡Œäº¤äº’ã€‚JMM ä¸»è¦è§£å†³åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­å¯èƒ½å‡ºç°çš„å¯è§æ€§ã€åŸå­æ€§å’Œæœ‰åºæ€§é—®é¢˜ã€‚

## å…³é”®æ¦‚å¿µ
**çº¿ç¨‹ä¸ä¸»å†…å­˜**ï¼š

æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼ˆä¹Ÿç§°ä¸ºæœ¬åœ°å†…å­˜ï¼‰ï¼Œå·¥ä½œå†…å­˜ä¿å­˜äº†è¯¥çº¿ç¨‹ä½¿ç”¨åˆ°çš„å˜é‡çš„å‰¯æœ¬ã€‚ä¸»å†…å­˜æ˜¯å…±äº«å†…å­˜åŒºåŸŸï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½å¯ä»¥è®¿é—®ä¸»å†…å­˜ä¸­çš„å˜é‡ã€‚

**å¯è§æ€§**ï¼š

å¯è§æ€§é—®é¢˜æ˜¯æŒ‡ä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„ä¿®æ”¹ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹æ˜¯å¦èƒ½å¤Ÿç«‹å³çœ‹åˆ°ã€‚JMM é€šè¿‡volatileå…³é”®å­—ã€é”æœºåˆ¶ï¼ˆå¦‚synchronizedï¼‰ç­‰æ¥ä¿è¯å˜é‡çš„å¯è§æ€§ã€‚

**åŸå­æ€§**ï¼š

åŸå­æ€§é—®é¢˜æ˜¯æŒ‡ä¸€ä¸ªæ“ä½œæ˜¯å¦æ˜¯ä¸å¯åˆ†å‰²çš„ï¼Œå³æ“ä½œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œå®Œæˆï¼Œè¦ä¹ˆå®Œå…¨ä¸æ‰§è¡Œã€‚JMM ä¿è¯äº†åŸºæœ¬æ•°æ®ç±»å‹çš„è¯»å†™æ“ä½œçš„åŸå­æ€§ï¼Œä½†å¯¹äºå¤åˆæ“ä½œï¼ˆå¦‚ i++ï¼‰åˆ™ä¸ä¿è¯ã€‚

**æœ‰åºæ€§**ï¼š

æœ‰åºæ€§é—®é¢˜æ˜¯æŒ‡ä»£ç æ‰§è¡Œçš„é¡ºåºæ˜¯å¦ä¸ç¨‹åºçš„é¡ºåºä¸€è‡´ã€‚ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¯èƒ½ä¼šå¯¹æŒ‡ä»¤è¿›è¡Œé‡æ’åºï¼Œä»¥æé«˜æ€§èƒ½ã€‚JMM é€šè¿‡volatileå…³é”®å­—ã€é”æœºåˆ¶ç­‰æ¥ä¿è¯å¿…è¦çš„æœ‰åºæ€§ã€‚

## å†…å­˜æ¨¡å‹ä¸­çš„åŒæ­¥æœºåˆ¶
### volatileå…³é”®å­—
volatileå˜é‡ä¿è¯äº†å¯¹è¯¥å˜é‡çš„è¯»å†™æ“ä½œçš„å¯è§æ€§å’Œæœ‰åºæ€§ã€‚

è¯»volatileå˜é‡æ—¶ï¼Œæ€»æ˜¯ä»ä¸»å†…å­˜ä¸­è¯»å–æœ€æ–°çš„å€¼ã€‚

å†™volatileå˜é‡æ—¶ï¼Œæ€»æ˜¯å°†æœ€æ–°çš„å€¼å†™å›ä¸»å†…å­˜ã€‚

### synchronizedå…³é”®å­—ï¼š
synchronizedå—æˆ–æ–¹æ³•ä¿è¯äº†è¿›å…¥ä¸´ç•ŒåŒºçš„çº¿ç¨‹å¯¹å…±äº«å˜é‡çš„ç‹¬å è®¿é—®ã€‚

é€€å‡ºsynchronizedå—æ—¶ï¼Œä¼šå°†å·¥ä½œå†…å­˜ä¸­çš„å˜é‡æ›´æ–°åˆ°ä¸»å†…å­˜ã€‚

è¿›å…¥synchronizedå—æ—¶ï¼Œä¼šä»ä¸»å†…å­˜ä¸­è¯»å–æœ€æ–°çš„å˜é‡å€¼ã€‚

### finalå…³é”®å­—ï¼š
finalå˜é‡åœ¨æ„é€ å™¨ä¸­åˆå§‹åŒ–åï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥ç«‹å³çœ‹åˆ°åˆå§‹åŒ–åçš„å€¼ã€‚

finalå˜é‡çš„å¼•ç”¨ä¸ä¼šè¢«ä¿®æ”¹ï¼Œå› æ­¤å¯ä»¥ç¡®ä¿å…¶å¯è§æ€§ã€‚

## å¯è§æ€§é—®é¢˜ç¤ºä¾‹
```plain
public class VisibilityExample {
    private static boolean stop = false;

    public static void main(String[] args) throws InterruptedException {
        Thread thread = new Thread(() -> {
            while (!stop) {
                // busy-wait
            }
        });
        thread.start();

        Thread.sleep(1000);
        stop = true; // å¦ä¸€ä¸ªçº¿ç¨‹å¯èƒ½ä¸ä¼šç«‹å³çœ‹åˆ°è¿™ä¸ªä¿®æ”¹
    }
}
```

ä¸»çº¿ç¨‹ä¿®æ”¹äº†stopå˜é‡ï¼Œä½†å¦ä¸€ä¸ªçº¿ç¨‹å¯èƒ½ä¸ä¼šç«‹å³çœ‹åˆ°ä¿®æ”¹ï¼Œå¯¼è‡´å¾ªç¯æ— æ³•ç»ˆæ­¢ã€‚å¯ä»¥ä½¿ç”¨volatileå…³é”®å­—è§£å†³è¿™ä¸ªé—®é¢˜ï¼š

```plain
public class VisibilityExample {
    private static volatile boolean stop = false;

    public static void main(String[] args) throws InterruptedException {
        Thread thread = new Thread(() -> {
            while (!stop) {
                // busy-wait
            }
        });
        thread.start();

        Thread.sleep(1000);
        stop = true; // å¦ä¸€ä¸ªçº¿ç¨‹ä¼šç«‹å³çœ‹åˆ°è¿™ä¸ªä¿®æ”¹
    }
}
```
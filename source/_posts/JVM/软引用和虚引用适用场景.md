---
title: ğŸ‘Œè½¯å¼•ç”¨å’Œè™šå¼•ç”¨é€‚ç”¨åœºæ™¯
date: 2025-04-26 13:33:41
tags:
	- JVM
categories: ç¬”è®°
--- 
# ğŸ‘Œè½¯å¼•ç”¨å’Œè™šå¼•ç”¨é€‚ç”¨åœºæ™¯

# é¢˜ç›®è¯¦ç»†ç­”æ¡ˆ
## è½¯å¼•ç”¨
è½¯å¼•ç”¨ä¸»è¦ç”¨äºå®ç°å†…å­˜æ•æ„Ÿçš„ç¼“å­˜ã€‚

è½¯å¼•ç”¨å¯ä»¥ç”¨äºç¼“å­˜é‚£äº›å¯ä»¥åœ¨å†…å­˜ä¸è¶³æ—¶å®‰å…¨å›æ”¶çš„å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œå›¾ç‰‡ç¼“å­˜ã€æ•°æ®ç¼“å­˜ç­‰åœºæ™¯ã€‚åœ¨å†…å­˜å……è¶³æ—¶ï¼Œç¼“å­˜çš„å¯¹è±¡ä¸ä¼šè¢«å›æ”¶ï¼›å½“å†…å­˜ä¸è¶³æ—¶ï¼Œç¼“å­˜çš„å¯¹è±¡ä¼šè¢«å›æ”¶ä»¥é‡Šæ”¾å†…å­˜ã€‚è¿™ç§æœºåˆ¶å¯ä»¥åœ¨ä¸å½±å“åº”ç”¨ç¨‹åºåŠŸèƒ½çš„å‰æä¸‹ï¼Œæœ€å¤§é™åº¦åœ°åˆ©ç”¨å¯ç”¨å†…å­˜ã€‚

```plain
import java.lang.ref.SoftReference;
import java.util.HashMap;
import java.util.Map;

public class SoftReferenceCache<K, V> {
    private final Map<K, SoftReference<V>> cache = new HashMap<>();

    public void put(K key, V value) {
        cache.put(key, new SoftReference<>(value));
    }

    public V get(K key) {
        SoftReference<V> ref = cache.get(key);
        if (ref != null) {
            return ref.get();
        }
        return null;
    }
}
```

SoftReferenceCacheä½¿ç”¨è½¯å¼•ç”¨æ¥ç¼“å­˜å¯¹è±¡ï¼Œå½“å†…å­˜ä¸è¶³æ—¶ï¼Œç¼“å­˜çš„å¯¹è±¡å¯èƒ½ä¼šè¢«å›æ”¶ã€‚

## è™šå¼•ç”¨
è™šå¼•ç”¨ä¸»è¦ç”¨äºè·Ÿè¸ªå¯¹è±¡è¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶çš„æ—¶é—´ï¼Œé€šå¸¸ç”¨äºå®ç°ç‰¹æ®Šçš„æ¸…ç†æœºåˆ¶ã€‚

è™šå¼•ç”¨å¯ä»¥ç”¨äºç®¡ç†é‚£äº›éœ€è¦åœ¨å¯¹è±¡è¢«å›æ”¶åè¿›è¡Œæ¸…ç†çš„èµ„æºï¼Œä¾‹å¦‚ç›´æ¥å†…å­˜ï¼ˆDirect Memoryï¼‰ã€æ–‡ä»¶å¥æŸ„ç­‰ã€‚

å½“å¯¹è±¡è¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶æ—¶ï¼Œè™šå¼•ç”¨ä¼šè¢«æ”¾å…¥å¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰ï¼Œé€šè¿‡å¤„ç†è¿™ä¸ªé˜Ÿåˆ—ï¼Œå¯ä»¥æ‰§è¡Œå¿…è¦çš„æ¸…ç†æ“ä½œã€‚

è™šå¼•ç”¨å¯ä»¥ç”¨äºç›‘æ§å¯¹è±¡ä½•æ—¶è¢«å›æ”¶ï¼Œä»è€Œåœ¨å¯¹è±¡å›æ”¶æ—¶æ‰§è¡Œä¸€äº›ç‰¹å®šçš„æ“ä½œï¼Œä¾‹å¦‚è®°å½•æ—¥å¿—ã€æ›´æ–°çŠ¶æ€ç­‰ã€‚

```plain
import java.lang.ref.PhantomReference;
import java.lang.ref.ReferenceQueue;

public class PhantomReferenceExample {
    public static void main(String[] args) throws InterruptedException {
        ReferenceQueue<Object> refQueue = new ReferenceQueue<>();
        Object obj = new Object();
        PhantomReference<Object> phantomRef = new PhantomReference<>(obj, refQueue);

        obj = null; // å…è®¸ obj å¯¹è±¡è¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶

        // å¼ºåˆ¶åƒåœ¾æ”¶é›†
        System.gc();

        // æ£€æŸ¥å¼•ç”¨é˜Ÿåˆ—
        if (refQueue.poll() != null) {
            System.out.println("Object has been collected");
            // æ‰§è¡Œæ¸…ç†æ“ä½œ
        }
    }
}
```

å½“objè¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶æ—¶ï¼ŒphantomRefä¼šè¢«æ”¾å…¥refQueueä¸­ï¼Œå¯ä»¥é€šè¿‡æ£€æŸ¥refQueueæ¥æ‰§è¡Œæ¸…ç†æ“ä½œã€‚

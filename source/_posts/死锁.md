---
title: 死锁 
date: 2024-10-10 17:33:00
tags:
	- 并发
categories: 笔记
---
<<<<<<< HEAD


=======
>>>>>>> a5eb6f5203a7e03c21785b519967b54588c89db8
## 死锁的定义

死锁是指两个或两个以上的进程（或线程）在执行过程中，因竞争资源或彼此通信而造成的一种阻塞现象。当这些进程都在等待对方释放资源时，就会形成一个无法打破的僵局，若无外力作用，它们都将无法继续执行。此时，系统处于死锁状态。

### 产生死锁的四个必要条件

1. **互斥条件**：一个资源每次只能被一个进程使用。
2. **占有且等待**：一个进程因请求资源而阻塞时，对已获得的资源保持不放。
3. **不可抢占**：进程已获得的资源，在未使用完之前，不能强行剥夺。
4. **循环等待条件**：若干进程之间形成一种头尾相接的循环等待资源关系。

### 如何解决死锁

解决死锁的方法主要分为预防死锁、避免死锁、检测死锁和解除死锁四种。

1. **预防死锁**：
   - 破坏互斥条件：允许资源被多个进程同时访问（但某些资源可能无法这样做）。
   - 破坏占有且等待条件：要求进程一次性申请所有所需资源，或者允许进程在持有资源的同时申请其他资源（但可能降低系统效率）。
   - 破坏不可抢占条件：允许进程被抢占已分配的资源（但可能导致数据不一致等问题）。
   - 破坏循环等待条件：对资源编号，要求进程按编号顺序申请资源（但可能增加资源管理的复杂性）。

2. **避免死锁**：
   - 使用银行家算法等算法来动态地检查资源分配的安全性，确保系统不会进入不安全状态。
   - 在资源分配过程中，采用资源预分配策略或资源按需分配策略，并监控系统的资源使用情况。

3. **检测死锁**：
   - 定期检查系统是否存在死锁现象，如使用资源分配图等方法。
   - 一旦发现死锁，立即采取措施进行解除。

4. **解除死锁**：
   - 终止一个或多个进程，以打破循环等待条件。
   - 回滚到安全状态，重新分配资源。
   - 在数据库系统中，可以采用自动回滚事务、重启事务等方法来解除死锁。

### 数据库死锁的发生与解决

在数据库中，死锁通常发生在多个事务并发执行时。当事务A持有资源A的锁并尝试获取资源B的锁时，而事务B持有资源B的锁并尝试获取资源A的锁时，就会发生死锁。

解决数据库死锁的方法包括：

- 避免并发修改：尽量减少多个事务对同一资源的并发访问。
- 保证操作顺序：确保多个事务按照相同的顺序访问资源。
- 使用锁超时机制：设置锁的超时时间，当事务持有锁超过一定时间时自动释放锁。
- 使用乐观锁或悲观锁等锁策略来管理资源访问。

综上所述，死锁是并发系统中常见的问题之一。通过理解死锁的产生条件、掌握解决死锁的方法以及合理设计资源访问策略，可以有效地预防和解决死锁问题。